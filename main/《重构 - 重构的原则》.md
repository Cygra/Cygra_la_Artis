## 重构的原则

From [重构 - 改善既有代码的设计]()

### 什么是重构？

重构是对软件内部结构的一种调整，目的是在不改变软件的可观察行为的前提下，提高软件的可理解性，降低软件的修改成本。

重构的关键在于运用大量微小且保持软件行为的步骤，一步步达成大规模的修改。

在重构的过程中，代码很少进入不可工作的状态。即使重构没有完成，工作也可以在任何时候停下来。**如果有人说他们的代码在重构的过程中有一两天时间是不可用的，基本上可以确定，他们在做的事不是重构。**

### 「两顶帽子」比喻

开发软件的时间可以被分配给两种截然不同的行为：添加新功能、重构。

添加新功能时，不应该修改既有代码，而是只管添加。重构时则不再添加新功能。

过程中，可能会在添加新功能时意识到，如果重构一下，添加会容易的多。于是换一顶帽子，重构一会儿，再戴回添加的帽子。

**无论何时，我都清楚自己戴的是哪一顶帽子。**

### 为何重构

- 重构改进软件的设计

- 重构使软件更易理解

- 重构帮助找到 bug

> 如果对代码进行重构，我就可以深入理解代码的所作所为，并立即把新的理解反映在代码当中。

- 重构提高编程速度

> 往东去 100 公里，不会往东一头把车开进树林，而是先向北开 20 公里上高速，然后再向东开 100 公里。后者的速度比前者要快上 3 倍。

### 何时重构

- 预备性重构：让添加新功能更容易

- 帮助理解的重构：使代码更易懂

> 初步的重构就像扫去窗上的尘埃，使我们得以看到窗外的风景。

- 捡垃圾式重构

> 至少要让营地比你到达时干净。

> 即使每次清理并不完整，代码也不会被破坏。

- 有计划的重构和见机行事的重构

> 绝大多数重构都在我做其他事的过程中自然发生。
>
> 添加新功能最快的方法往往是先修改现有的代码，使新功能更容易被加入。

- 长期重构

- code review 时重构

- 怎么对经理说

- 何时不应该重构

> 如果丑陋的代码可能被隐藏在一个 api 之下，我就可以容忍它继续保持丑陋。只有当我需要理解其工作原理 / 修改它时，重构才有价值。

### 重构的挑战

- 延缓新功能的开发

> 重构的意义不在于把代码库打磨得闪闪发光，而是纯粹的经济角度出发的考量。

- 代码所有权

- 分支

- 测试

- 遗留代码

- 数据库
